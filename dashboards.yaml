views:
  - title: Battery Monitoring
    cards:
      - type: custom:mushroom-chips-card
        chips:
          - type: template
            icon: mdi:battery-alert
            icon_color: red
            content: >
              {% set low_batteries = states.sensor 
                | selectattr('entity_id', 'match', 'sensor\.battery_.*')
                | selectattr('state', 'is_number')
                | selectattr('state', 'lt', 20)
                | list | count %}
              {% if low_batteries > 0 %}
                {{ low_batteries }} Critical
              {% endif %}
          - type: template
            icon: mdi:battery-30
            icon_color: orange
            content: >
              {% set low_batteries = states.sensor 
                | selectattr('entity_id', 'match', 'sensor\.battery_.*')
                | selectattr('state', 'is_number')
                | selectattr('state', 'ge', 20)
                | selectattr('state', 'lt', 30)
                | list | count %}
              {% if low_batteries > 0 %}
                {{ low_batteries }} Low
              {% endif %}

      # Phone Devices
      - type: custom:mushroom-title-card
        title: Mobile Devices
      - type: grid
        columns: 3
        square: false
        cards:
          # Brian's Phone
          - type: custom:mushroom-entity-card
            entity: sensor.battery_brian_phone
            name: Brian's Phone
            icon: mdi:cellphone
            icon_color: >-
              {% set level = states('sensor.battery_brian_phone') | int(0) %}
              {% if level > 50 %}
                green
              {% elif level > 20 %}
                orange
              {% else %}
                red
              {% endif %}
            secondary_info: >-
              {% set level = states('sensor.battery_brian_phone') | int(0) %}
              {% set charging = is_state('binary_sensor.brian_phone_is_charging', 'on') %}
              {{ level }}%{% if charging %} âš¡{% endif %}

          # Hester's Phone  
          - type: custom:mushroom-entity-card
            entity: sensor.battery_hester_phone
            name: Hester's Phone
            icon: mdi:cellphone
            icon_color: >-
              {% set level = states('sensor.battery_hester_phone') | int(0) %}
              {% if level > 50 %}
                green
              {% elif level > 20 %}
                orange
              {% else %}
                red
              {% endif %}
            secondary_info: >-
              {% set level = states('sensor.battery_hester_phone') | int(0) %}
              {% set charging = is_state('binary_sensor.hester_phone_is_charging', 'on') %}
              {{ level }}%{% if charging %} âš¡{% endif %}

          # Towner's Phone
          - type: custom:mushroom-entity-card
            entity: sensor.battery_towner_phone
            name: Towner's Phone
            icon: mdi:cellphone
            icon_color: >-
              {% set level = states('sensor.battery_towner_phone') | int(0) %}
              {% if level > 50 %}
                green
              {% elif level > 20 %}
                orange
              {% else %}
                red
              {% endif %}
            secondary_info: >-
              {% set level = states('sensor.battery_towner_phone') | int(0) %}
              {% set charging = is_state('binary_sensor.towner_phone_is_charging_2', 'on') %}
              {{ level }}%{% if charging %} âš¡{% endif %}

      # Z-Wave Remote Controls
      - type: custom:mushroom-title-card
        title: Remote Controls
      - type: grid
        columns: 2
        square: false
        cards:
          # Brian's Bedroom Remote
          - type: custom:mushroom-entity-card
            entity: sensor.battery_bedroom_remote_brian
            name: Brian's Remote
            icon: mdi:remote
            icon_color: >-
              {% set level = states('sensor.battery_bedroom_remote_brian') | int(0) %}
              {% if level > 30 %}
                green
              {% elif level > 20 %}
                orange
              {% else %}
                red
              {% endif %}
            secondary_info: >-
              {% set level = states('sensor.battery_bedroom_remote_brian') | int(0) %}
              {% set charging = is_state('binary_sensor.bedroom_remote_brian_battery_is_charging', 'on') %}
              {{ level }}%{% if charging %} âš¡{% endif %}

          # Hester's Bedroom Remote
          - type: custom:mushroom-entity-card
            entity: sensor.battery_bedroom_remote_hester
            name: Hester's Remote
            icon: mdi:remote
            icon_color: >-
              {% set level = states('sensor.battery_bedroom_remote_hester') | int(0) %}
              {% if level > 30 %}
                green
              {% elif level > 20 %}
                orange
              {% else %}
                red
              {% endif %}
            secondary_info: >-
              {% set level = states('sensor.battery_bedroom_remote_hester') | int(0) %}
              {% set charging = is_state('binary_sensor.bedroom_remote_hester_battery_is_charging', 'on') %}
              {{ level }}%{% if charging %} âš¡{% endif %}

      # Roomba Vacuum
      - type: custom:mushroom-title-card
        title: Cleaning Devices
      - type: custom:mushroom-entity-card
        entity: sensor.battery_sally
        name: Sally (Roomba)
        icon: mdi:robot-vacuum
        icon_color: >-
          {% set level = states('sensor.battery_sally') | int(0) %}
          {% if level > 50 %}
            green
          {% elif level > 20 %}
            orange
          {% else %}
            red
          {% endif %}
        secondary_info: >-
          {% set level = states('sensor.battery_sally') | int(0) %}
          {% set charging = is_state('vacuum.sally', 'docked') %}
          {{ level }}%{% if charging %} ðŸ {% endif %}

      # Security & Motion Sensors
      - type: custom:mushroom-title-card
        title: Security & Motion Sensors
      - type: custom:mushroom-entity-card
        entity: sensor.battery_master_bedroom
        name: Master Bedroom Motion
        icon: mdi:motion-sensor
        icon_color: >-
          {% set level = states('sensor.battery_master_bedroom') | int(0) %}
          {% if level > 30 %}
            green
          {% elif level > 20 %}
            orange
          {% else %}
            red
          {% endif %}
        secondary_info: >-
          {% set level = states('sensor.battery_master_bedroom') | int(0) %}
          {{ level }}% Battery

      # All Battery Sensors Overview (auto-generated from template sensors)
      - type: custom:mushroom-title-card
        title: All Battery Devices
      - type: entities
        entities:
          - type: template
            content: |
              {% for entity in states.sensor %}
                {% if entity.entity_id.startswith('sensor.battery_') %}
                  - entity: {{ entity.entity_id }}
                    name: {{ entity.name or entity.entity_id.replace('sensor.battery_', '').replace('_', ' ').title() }}
                    secondary_info: >-
                      {{ entity.state }}% Battery
                {% endif %}
              {% endfor %}

      # Test Card to verify template sensors
      - type: custom:mushroom-title-card
        title: Debug Info
      - type: custom:mushroom-template-card
        primary: Template Sensor Count
        secondary: >
          {% set battery_sensors = states.sensor 
            | selectattr('entity_id', 'match', 'sensor\.battery_.*')
            | list %}
          {{ battery_sensors | count }} template battery sensors found
        icon: mdi:battery-heart
        icon_color: green
        tap_action:
          action: none
